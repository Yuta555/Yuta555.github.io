<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>NYC Crime</title>
		<script src="https://d3js.org/d3.v4.js"></script>  <!-- link to D3 library -->
		<script src="https://d3js.org/d3-tile.v0.0.min.js"></script>  <!-- link to D3 library -->
		<script src="https://d3js.org/topojson.v1.min.js"></script>  <!-- link to D3 library -->
		<style type="text/css">
			h1 {color:red;}		/* CSS styling */
			p {color:blue;}
		</style>

	</head>

	<body>
		<h1>NYC Crime Map</h1>      <!-- some HTML -->
		<h2>D3 D3 D3</h2></h2>
		<h3 style="font-family: Palatino;">h3 header</h3>
		<p>paragraphoooo</p>

		<script>
		
		const colors = ["#FEED5E9","#FCAE91","#FB6A4A","#DE2D26","A50F15"],
		      blues = ["#EFF3FF","#BDD7E7","6BAED6","#3182BD","#08519C"],
		      margin = {top:10, right:10, bottom:10, left:10},
		      i = 0;
		      
		      
		const projection = d3.geoMercator()
		                     .scale(1 / 2 * Math.PI)
		                     .translate([0, 0]);
		
		const path = d3.geoPath()
		               .projection(projection);
		               
		const tile = d3.tile()
		               .size([500, 500]);
		                    
		
		const svg = d3.select("body")
		              .append("svg")
		              .attr("width", 500)
		              .attr("height", 500)
		              .attr("transform", "translate(" + margin.left + "," + margin.top + ")";
		              // .on("click", homePage);
		              
    const map = svg.append("g");
    const raster = svg.append("g");
    
    d3.csv("census.black.csv", function(error, data){
      if (error) throw error;
      censusBlack = data;
    });
		
    d3.json("https://github.com/Russell-A/NYCrime/blob/main/dataset/precincts.geojson", function(error, data) {
      precincts = map.selectAll("path")
                    .data(data.features)
                    .enter()
                    .append("path")
                    .attr("fill", function(d, i) {
                      return(colors[blues.indexOf(d.properties.Color)]);
                    })
                    .attr("stroke", "black")
                    .on("mouseover", MouseOver);
                    //.on("mouseout", MouseOut)
                    //.on("click", MouseClick);
                    
      const center = projection([-73.92, 40.80]);
    }
    )
    
    function zoomed() {
      const transform = d3.event.transform;
      if (!run) {
        d3.selectAll("#barrect").classed("on", false);
        d3lselectAll("#barrect").attr("fill", "grey");
        svg.selectAll("#sqf").removed();
        on = false;
        i = 0;
      }
      const tiles = tile
            .scale(transform.k)
            .translate([transform.x, transform.y])
            ();
            
      projection.scale(transform.k / 2*Math.PI)
                .translate([transform.x, transform.y]);
                
      precincts.attr("d", path);
      
      if (transform.k > 2000000) {
        map.attr("fill", "no-fill").attr("fill-opacity", 0);
      } else {
        map.attr("fill-opacity", .75);
      }
      
      const image = raster.attr("transform", stringify(tiles.scale, tiles.translate))
                          .selectAll("image")
                          .data(tiles, function(d) { return d;})
                          
      image.exit().remove();
      
      image.enter().append("image")
                   .attr("xlink:href", function(d) {
                     return "http://" + "abc"[d[1] % 3] + ".tile.openstreetmap.org/" + d[2] + "/" + d[0] + "/" + d[1] + ".png";
                   })
                   .attr("x", function(d) { return d[0]*256; })
                   .attr("y", function(d) { return d[1]*256; })
                   .attr("width", 256)
                   .attr("height", 256);
    }
    
    function stringify(scale, translate) {
      const k = scale / 256,
            r = scale % 1 ? number : Math.round;
      return "translate(" + r(translate[0] * scale) +"," + r(translate[1] * scale) + ") scale(" + k + ")";
    }
    

    
    // 
    function MouseOver() {
      d3.select(this).attr("fill", "grey");
    }
    
    
		    
		</script>

	</body>

</html>
